



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.6">
    
    
      
        <title>Creating applications - JSTP Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#creating-applications" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="JSTP Documentation" class="md-header-nav__button md-logo">
          
            <img src="https://cdn.rawgit.com/metarhia/Metarhia/master/Logos/metarhia-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                JSTP Documentation
              </span>
              <span class="md-header-nav__topic">
                Creating applications
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/metarhia/jstp/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      metarhia/jstp
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="JSTP Documentation" class="md-nav__button md-logo">
      
        <img src="https://cdn.rawgit.com/metarhia/Metarhia/master/Logos/metarhia-logo.svg" width="48" height="48">
      
    </a>
    JSTP Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/metarhia/jstp/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      metarhia/jstp
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Creating applications" class="md-nav__link md-nav__link--active">
      Creating applications
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../initializing-a-server/" title="Initializing a server" class="md-nav__link">
      Initializing a server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../establishing-client-connection/" title="Establishing client connection" class="md-nav__link">
      Establishing client connection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../remote-apis/" title="Remote APIs" class="md-nav__link">
      Remote APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../remote-events/" title="Remote events" class="md-nav__link">
      Remote events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example-chat-application/" title="Example: chat application" class="md-nav__link">
      Example: chat application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/application/" title="Application" class="md-nav__link">
      Application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/connection/" title="Connection" class="md-nav__link">
      Connection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/session/" title="Session" class="md-nav__link">
      Session
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/remote-proxy/" title="RemoteProxy" class="md-nav__link">
      RemoteProxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/transport/" title="Transport" class="md-nav__link">
      Transport
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Available transports
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Available transports
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/net/" title="net" class="md-nav__link">
      net
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/tls/" title="tls" class="md-nav__link">
      tls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/ws/" title="ws" class="md-nav__link">
      ws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/ws-browser/" title="ws-browser" class="md-nav__link">
      ws-browser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/wss/" title="wss" class="md-nav__link">
      wss
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/simple-connect-policy/" title="SimpleConnectPolicy" class="md-nav__link">
      SimpleConnectPolicy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/session-storage-provider/" title="SessionStorageProvider" class="md-nav__link">
      SessionStorageProvider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/simple-session-storage-provider/" title="SimpleSessionStorageProvider" class="md-nav__link">
      SimpleSessionStorageProvider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/auth-policy/" title="AuthPolicy" class="md-nav__link">
      AuthPolicy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/client/" title="Client" class="md-nav__link">
      Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/server/" title="Server" class="md-nav__link">
      Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../cli/" title="JSTP CLI" class="md-nav__link">
      JSTP CLI
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/metarhia/jstp/edit/master/docs/tutorial/creating-applications.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="creating-applications">Creating applications<a class="headerlink" href="#creating-applications" title="Permanent link">&para;</a></h1>
<p>First of all, let's create an application, which will be the basis of our future
server API. The <a href="../../api/application/#class-jstpapplication"><code>Application</code></a> is the core high-level abstraction
of the framework. Every application can consist of a number of interfaces,
each of which has its methods.</p>
<p>For this tutorial, we will create a pretty straightforward chat application
with two interfaces: <code>auth</code> and <code>chat</code>. The API will be quite plain with an
expected scenario like this:</p>
<ol>
<li>User registers a username and password if there is no "account" yet</li>
<li>User logins with valid credentials</li>
<li>Then the user can send messages to all connected users and receive messages
   from others</li>
</ol>
<p>For the sake of simplicity we won't use a real database here for storing
users' credentials or any cryptographic techniques for security, which you
probably would implement in real projects, because our primary goal is to show
the basic principles of using JSTP and don't get distracted by implementing
a lot of other unrelated functionality.</p>
<p>Let's create a <code>chatApp.js</code> file in our project directory:</p>
<div class="codehilite"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">jstp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@metarhia/jstp&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">ERR_NOT_AUTHENTICATED</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="nx">ERR_ALREADY_REGISTERED</span><span class="o">:</span> <span class="mi">1001</span><span class="p">,</span>
  <span class="nx">ERR_INVALID_CREDENTIALS</span><span class="o">:</span> <span class="mi">1002</span><span class="p">,</span>
  <span class="nx">ERR_ALREADY_AUTHENTICATED</span><span class="o">:</span> <span class="mi">1003</span><span class="p">,</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">auth</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">register</span><span class="o">:</span> <span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">users</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">username</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">ERR_ALREADY_REGISTERED</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">users</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">login</span><span class="o">:</span> <span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">ERR_ALREADY_AUTHENTICATED</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">const</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">username</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pass</span> <span class="o">||</span> <span class="nx">pass</span> <span class="o">!==</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">ERR_INVALID_CREDENTIALS</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">connection</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">();</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">chat</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">sendMessage</span><span class="o">:</span> <span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">username</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">ERR_NOT_AUTHENTICATED</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">const</span> <span class="p">{</span> <span class="nx">server</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">conn</span> <span class="k">of</span> <span class="nx">server</span><span class="p">.</span><span class="nx">getClients</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">conn</span> <span class="o">!==</span> <span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">conn</span><span class="p">.</span><span class="nx">emitRemoteEvent</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">message</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">callback</span><span class="p">();</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">chatApp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">jstp</span><span class="p">.</span><span class="nx">Application</span><span class="p">(</span><span class="s1">&#39;chatApp&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">auth</span><span class="p">,</span> <span class="nx">chat</span> <span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">chatApp</span><span class="p">;</span>
</pre></div>


<p>This code may raise some questions, so letâ€™s go over it to see how it works.</p>
<p>After requiring <code>jstp</code> module, we created an object to map error names to their
codes and return them to client in case something went wrong.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">ERR_NOT_AUTHENTICATED</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="nx">ERR_ALREADY_REGISTERED</span><span class="o">:</span> <span class="mi">1001</span><span class="p">,</span>
  <span class="nx">ERR_INVALID_CREDENTIALS</span><span class="o">:</span> <span class="mi">1002</span><span class="p">,</span>
  <span class="nx">ERR_ALREADY_AUTHENTICATED</span><span class="o">:</span> <span class="mi">1003</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>


<p>Next, we created a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"><code>Map</code></a> for users' credentials, which emulates a real
project database. Here we'll store user names and passwords, when they register.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
</pre></div>


<p>After these preparatory steps, we are ready to implement two interfaces for
the chat application: <code>auth</code> interface with the <code>register</code> and <code>login</code>
methods and <code>chat</code> with method <code>sendMessage</code>. This example API is quite
simplified, and its implementation only shows the main purpose of methods,
so we won't examine them in detail.</p>
<blockquote>
<p>Note that first argument of every method in interfaces is always
<a href="../../api/connection/#class-jstpconnection"><code>connection</code></a> and last is always callback with error first
contract, so that error (or <code>null</code> if there is no error) and all the results
will be returned in it.</p>
</blockquote>
<p>There is one more thing you can be curious about -
<a href="../../api/session/#class-jstpsession"><code>connection.session</code></a>, which extends <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"><code>Map</code></a> class and thus
can be used to store the current session state independently of connection.
For example, in <code>auth</code> interface's <code>login</code> method after the user logged in,
we just set key <code>'user'</code> to <code>username</code> value in current client session to check
later if the user has been authorized.</p>
<div class="codehilite"><pre><span></span><span class="nx">connection</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">);</span>
</pre></div>


<p>Further in <code>chat</code> interface's <code>sendMessage</code> method we access connection's
<a href="../../api/server/#class-jstpserver"><code>server</code></a> so that we can get all server's client connections. For each
of them, we send the given message and the username of the sender by emitting a
remote event in their connections (more about <a href="../remote-events/">remote events</a>):</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">server</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">conn</span> <span class="k">of</span> <span class="nx">server</span><span class="p">.</span><span class="nx">getClients</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">conn</span> <span class="o">!==</span> <span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">emitRemoteEvent</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">message</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<blockquote>
<p>An alternative way to send a message for all other connected users in chat is
to use <a href="../../api/server/#serverbroadcastinterfacename-eventname-args"><code>server.broadcast()</code></a> method:</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">server</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">;</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
</pre></div>


<blockquote>
<p>In this case, you should check in client event handler (more about this
<a href="../remote-events/">here</a>) if the sender's username is not client's username
because the server will send the event message to all of the connected clients
and we don't want to receive our messages back.</p>
</blockquote>
<p>After we've implemented interfaces, we are ready to create our chat application:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">chatApp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">jstp</span><span class="p">.</span><span class="nx">Application</span><span class="p">(</span><span class="s1">&#39;chatApp&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">auth</span><span class="p">,</span> <span class="nx">chat</span> <span class="p">});</span>
</pre></div>


<blockquote>
<p>JSTP supports multiple versions per server <a href="../../api/application/#class-jstpapplication"><code>application</code></a>,
application name should contain version after '@' (e.g. app@1.0.0). As we
don't specify the version in our app, the default <code>1.0.0</code> is used.</p>
</blockquote>
<p>So we've just created a simple <a href="../../api/application/#class-jstpapplication"><code>application</code></a> with some basic
interfaces for our future server, which will be created at the next step.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../setup/" title="Setup" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Setup
              </span>
            </div>
          </a>
        
        
          <a href="../initializing-a-server/" title="Initializing a server" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Initializing a server
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/metarhia" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.5e60981f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>